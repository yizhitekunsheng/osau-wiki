---
import '../styles/global.css';
import Header from '../components/Header.astro';

interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = 'OSAU Wiki - GoodGame Empire guides and strategies',
} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title} | OSAU Wiki</title>
  </head>
  <body>
    <Header />
    <main>
      <slot />
    </main>
    <footer class="footer">
      <div class="container">
        <p>OSAU Wiki - One Sun Above Us</p>
        <p class="footer-note">
          Fan-made wiki for GoodGame Empire. Not affiliated with Goodgame
          Studios.
        </p>
      </div>
    </footer>
    <button class="scroll-top" id="scroll-top" aria-label="Scroll to top"
      >&uarr;</button
    >
  </body>
</html>

<style>
  main {
    min-height: calc(100vh - 200px);
    padding: 2rem 0;
  }

  .footer {
    padding: 2rem 0;
    text-align: center;
    border-top: 1px solid var(--color-border);
    color: var(--color-text-muted);
    font-size: 0.875rem;
  }

  .footer p {
    margin: 0.25rem 0;
  }

  .footer-note {
    font-size: 0.75rem;
    opacity: 0.7;
  }

  .scroll-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    color: var(--color-text-muted);
    font-size: 1.25rem;
    cursor: pointer;
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.2s,
      visibility 0.2s,
      transform 0.2s,
      background 0.2s;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }

  .scroll-top:hover {
    background: var(--color-bg-hover);
    color: var(--color-text);
    transform: translateY(-2px);
  }

  .scroll-top.visible {
    opacity: 1;
    visibility: visible;
  }
</style>

<script is:inline>
  // Scroll to top button
  const scrollBtn = document.getElementById('scroll-top');

  window.addEventListener('scroll', () => {
    if (window.scrollY > 300) {
      scrollBtn?.classList.add('visible');
    } else {
      scrollBtn?.classList.remove('visible');
    }
  });

  scrollBtn?.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // Card fade-in animation on scroll
  function initCardAnimations() {
    const cards = document.querySelectorAll('.card');

    if (cards.length === 0) return;

    const cardObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const card = entry.target;
            const allCards = Array.from(document.querySelectorAll('.card'));
            const delay = (allCards.indexOf(card) % 3) * 100;
            setTimeout(() => {
              card.classList.add('visible');
            }, delay);
          }
        });
      },
      {
        threshold: 0.1,
        rootMargin: '50px 0px -50px 0px',
      }
    );

    cards.forEach((card) => cardObserver.observe(card));
  }

  // Run when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCardAnimations);
  } else {
    initCardAnimations();
  }
</script>
